#!/usr/bin/env node

var program = require('commander')
  .usage('[package name]')
  .parse(process.argv)

var name = program.args[0]
if (!name) {
  console.error('a package name was not defined!')
  process.exit(1)
}

require('request')('https://registry.npmjs.org/' + name, function (err, res, body) {
  if (err) {
    console.error(err.stack)
    process.exit(1)
  }
  if (res.statusCode !== 200) {
    console.error('a package by the name of "%s" was not found', name)
    process.exit(1)
  }
  body = JSON.parse(body) // you're useless, request!

  var repo = body.repository
  if (!repo) {
    console.error('package "%s" did not define a repository', name)
    process.exit(1)
  }

  var url = require('url')
  var obj = url.parse(repo.url)
  if (obj.protocol !== 'https:') obj.protocol = 'https:'
  require('open')(url.format(obj))
})
